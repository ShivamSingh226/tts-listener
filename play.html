<!DOCTYPE html>
<html>
<head>
    <title>Live TTS - Tiledesk Simulation</title>
</head>
<body>
    <h1>Live TTS Playback (Tiledesk Payload)</h1>
    <input type="text" id="textInput" placeholder="Enter text for Tiledesk">
    <button id="playBtn">Send Payload</button>
    <audio id="audioPlayer" controls></audio>

    <script>
    const playBtn = document.getElementById("playBtn");
    const textInput = document.getElementById("textInput");
    const audioPlayer = document.getElementById("audioPlayer");

    playBtn.onclick = async () => {
        const text = textInput.value;
        if (!text) return;

        const payload = {
            timestamp: Date.now(),
            payload: {
                senderFullname: "tiledesk-tts", // important for filtering
                type: "text",
                channel_type: "group",
                status: 0,
                text
            }
        };

        const response = await fetch("/tts", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload) // full Tiledesk-like format
        });

        if (!response.ok) {
            alert("Error fetching TTS");
            return;
        }

        const audioBlob = await response.blob();
        audioPlayer.src = URL.createObjectURL(audioBlob);
        audioPlayer.play();
    };
    </script>
</body>
</html>
